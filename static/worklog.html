<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>11q2’s WorkLog</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="header">
    <h1>11q2</h1>
    <div class="nav">
        <a href="/">Dashboard</a>
        <a href="/worklog">Tasks</a>
        <a href="#">Stats</a>
        <a href="#">Settings</a>
    </div>
</div>

<div class="main-container">
    <!-- SIDEBAR -->
    <div class="sidebar">
        <!-- Current Work Status window -->
        <div class="working-window">
            <div class="window-header">Current Work Status</div>
            <div class="window-content">
                Currently working: <strong><span id="working-indicator">NO</span></strong>
            </div>
        </div>
    </div>

    <!-- RIGHT PANEL / HISTORY -->
    <div class="history" id="history">

        <!-- Select Date window moved here -->
        <div class="date-window" id="date-window">
            <div class="window-header">Select Date</div>
            <div class="window-content">
                <input type="date" id="date" name="date">
            </div>
        </div>


        <p><strong>Tasks done today:</strong></p>
        {{if .Tasks}}
        {{range .Tasks}}
        <div class="day-log" data-date="{{.DoneAt.Time.Format `2006-01-02`}}">
            <ul>
                <li>{{.Name}} — {{.Description}}, ({{.Status}}), DONE AT
                    {{if .DoneAt.Valid}}
                    <span class="done-at">{{.DoneAt.Time}}</span>
                    {{else}}
                    <span class="done-at">-</span>
                    {{end}}
                    UTC
                </li>
            </ul>
        </div>
        {{end}}
        {{else}}
        <p>No completed tasks for today.</p>
        {{end}}

    </div>
</div>

<!-- SCRIPTS -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // --- 1) Format DONE AT timestamps ---
        document.querySelectorAll('.done-at').forEach(span => {
            const raw = span.textContent.trim();
            if (!raw || raw === '-') return;
            const d = new Date(raw);
            span.textContent = d.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: 'numeric',
                second: 'numeric',
                hour12: false
            });
        });

        // --- 2) Date‐picker init & filtering ---
        const picker = document.getElementById("date");
        const logs = document.querySelectorAll(".day-log");
        const dateWindow = document.getElementById("date-window");

        // Helper to format YYYY-MM-DD
        const fmt = d => d.toISOString().split("T")[0];

        function filterBy(dateStr) {
            logs.forEach(log => {
                log.style.display = (log.dataset.date === dateStr) ? "block" : "none";
            });
        }

        // Initialize picker value & filter
        const saved = localStorage.getItem("selectedDate");
        picker.value = saved || fmt(new Date());
        filterBy(picker.value);

        picker.addEventListener("change", function () {
            localStorage.setItem("selectedDate", this.value);
            filterBy(this.value);
        });

        dateWindow.addEventListener('click', e => {
            // if they click directly on the <input>, let it behave normally
            if (e.target !== picker) {
                // Chrome et al: use showPicker() if available
                if (typeof picker.showPicker === 'function') {
                    picker.showPicker();
                } else {
                    // fallback: programmatically click the input to open the UI
                    picker.click();
                }
            }
        });

        // --- 4) Populate Current Work Status ---
        const ind = document.getElementById('working-indicator');
        const working = localStorage.getItem('isWorking') === 'true';
        ind.textContent = working ? 'YES' : 'NO';

        // --- 3) Click anywhere in the date‐window to open calendar ---
        dateWindow.addEventListener('click', () => {
            // make sure input is focused (for keyboard nav etc.)
            picker.focus();

            // Chrome et al: use showPicker() if available
            if (typeof picker.showPicker === 'function') {
                picker.showPicker();
            } else {
                // fallback: programmatically click the input to open the UI
                picker.click();
            }
        });

    });
</script>


</body>

</html>
