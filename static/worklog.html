<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>11q2’s WorkLog</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="header">
    <h1>11q2</h1>
    <div class="nav">
        <a href="/">Dashboard</a>
        <!-- normalize to trailing slash so it matches your mux.HandleFunc("/worklog/", ...) -->
        <a href="/worklog/">Tasks</a>
        <a href="#">Stats</a>
        <a href="#">Settings</a>
    </div>
</div>

<div class="main-container">
    <!-- SIDEBAR -->
    <div class="sidebar">
        <!-- Current Work Status window -->
        <div class="working-window">
            <div class="window-header">Current Work Status</div>
            <div class="window-content">
                Currently working: <strong><span id="working-indicator">NO</span></strong>
            </div>
        </div>
    </div>

    <!-- RIGHT PANEL / HISTORY -->
    <div class="history" id="history">

        <!-- Select Date window -->
        <div class="date-window" id="date-window">
            <div class="window-header">Select Date</div>
            <div class="window-content">
                <input type="date" id="date" name="date" required>
            </div>
        </div>

        <p><strong>Tasks done on this day:</strong></p>
        {{if .Tasks}}
        {{range .Tasks}}
        <div class="day-log" data-date="{{.DoneAt.Time.Format `2006-01-02`}}">
            <ul>
                <li>{{.Name}} — {{.Description}}, ({{.Status}}), DONE AT
                    {{if .DoneAt.Valid}}
                    <span class="done-at">{{.DoneAt.Time}}</span>
                    {{else}}
                    <span class="done-at">-</span>
                    {{end}}
                    UTC
                </li>
            </ul>
        </div>
        {{end}}
        {{else}}
        <p>No completed tasks for this date.</p>
        {{end}}

    </div>
</div>

<!-- SCRIPTS -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // --- 1) Format DONE AT timestamps ---
        document.querySelectorAll('.done-at').forEach(span => {
            const raw = span.textContent.trim();
            if (!raw || raw === '-') return;
            const d = new Date(raw);
            span.textContent = d.toLocaleString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: 'numeric',
                minute: 'numeric',
                second: 'numeric',
                hour12: false
            });
        });

        // --- 2) Date‐picker reload on change ---
        const picker = document.getElementById("date");
        // initialize from ?date=… or default to today
        const params = new URLSearchParams(window.location.search);
        const today = new Date().toISOString().split("T")[0];
        picker.value = params.get("date") || today;

        picker.addEventListener("change", function () {
            // navigate to /worklog/?date=YYYY-MM-DD
            window.location.href = `/worklog/?date=${this.value}`;
        });

        // --- 3) Populate Current Work Status ---
        const ind = document.getElementById('working-indicator');
        const working = localStorage.getItem('isWorking') === 'true';
        ind.textContent = working ? 'YES' : 'NO';
    });
</script>

</body>

</html>
