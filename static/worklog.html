<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>11q2`s WorkLog</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>

    <div class="header">
        <h1>11q2</h1>
        <div class="nav">
            <a href="#">Dashboard</a>
            <a href="#">Tasks</a>
            <a href="#">Stats</a>
            <a href="#">Settings</a>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="date-picker">
                <label for="date">Select Date:</label>
                <input type="date" id="date" name="date">
            </div>
        </div>

        <div class="history" id="history">
            {{range .}}
            <div class="day-log" data-date="{{.Date}}">
                <ul>
                    {{range .Tasks}}
                    <li>{{.Name}} â€” {{.Description}}, ({{.Status}}), DONE AT
                        {{if .DoneAt.Valid}}
                        <span class="done-at">{{.DoneAt.Time}}</span>
                        {{else}}
                        <span class="done-at">-</span>
                        {{end}}
                        UTC
                    </li>
                    {{end}}
                </ul>
            </div>
            {{end}}
        </div>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const picker = document.getElementById("date");
            const logs = document.querySelectorAll(".day-log");

            function formatDateString(date) {
                return date.toISOString().split("T")[0];
            }

            function formatHumanReadableDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: 'numeric',
                    second: 'numeric',
                    hour12: false
                });
            }

            // Format all DONE AT timestamps
            document.querySelectorAll('.done-at').forEach(span => {
                const rawDate = span.textContent.trim();
                if (!rawDate || rawDate === '-') return;

                const formattedDate = formatHumanReadableDate(rawDate);
                span.textContent = formattedDate;
            });

            // Handler to filter logs by date
            function filterLogsByDate(selectedDate) {
                let found = false;

                logs.forEach(log => {
                    if (log.dataset.date === selectedDate) {
                        log.style.display = "block";
                        found = true;
                    } else {
                        log.style.display = "none";
                    }
                });

                if (!found) {
                    alert("No logs found for this date");
                }
            }

            // Load last selected date
            const savedDate = localStorage.getItem("selectedDate");
            const today = new Date();
            const defaultDate = savedDate || formatDateString(today);
            picker.value = defaultDate;
            filterLogsByDate(defaultDate);

            picker.addEventListener("change", function () {
                const selectedDate = this.value;
                localStorage.setItem("selectedDate", selectedDate);
                filterLogsByDate(selectedDate);
            });
        });
    </script>


</body>

</html>